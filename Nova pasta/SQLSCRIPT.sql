
-- CONFERIR SE HA DADOS REPETIDOS 
SELECT DISTINCT(NUM_BO)FROM RouboVeiculos

SELECT NUM_BO
FROM RouboVeiculos
GROUP BY NUM_BO
HAVING COUNT(*) > 1;

				**** ANALISES****


-- QTD ROUBOS POR BAIRRO E % DE CADA BAIRRO (TOP 10)
SELECT TOP(10)
	DENSE_RANK() OVER(ORDER BY COUNT(*) DESC) AS 'RANK',
    	BAIRRO,
    	COUNT(*) AS 'QTD ROUBOS/BAIRRO',
	SUM(COUNT(*)) OVER () AS 'TOTAL ROUBOS',
	CONCAT(FORMAT(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 'N2'), ' %') AS 	'% BAIRRO'
FROM RouboVeiculos
WHERE BAIRRO IS NOT NULL
GROUP BY BAIRRO

OUTPUT >
/*RANK		BAIRRO				QTD ROUBOS/BAIRRO		TOTAL ROUBOS		% BAIRRO
1		CENTRO					40			1683			2,38 %
2		SAO MATEUS				29			1683			1,72 %
3		CAPAO REDONDO				20			1683			1,19 %
4		IPIRANGA				19			1683			1,13 %
4		SAUDE					19			1683			1,13 %
5		ITAQUERA				18			1683			1,07 %
6		CAMPO LIMPO				17			1683			1,01 %
7		SACOMA					16			1683			0,95 %
7		SANTO AMARO				16			1683			0,95 %
8		PEDREIRA				13			1683			0,77 %
*/




-- QTD ROUBOS POR CIDADE E % DE CADA CIDADE(TOP 10)
SELECT TOP(10)
	DENSE_RANK() OVER(ORDER BY COUNT(*) DESC) AS 'RANK',
    	CIDADE,
    	COUNT(*) AS 'QTD ROUBOS/CIDADE',
	SUM(COUNT(*)) OVER () AS 'TOTAL_ROUBOS',
    	CONCAT(FORMAT(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 'N2'), ' %') AS 	'% POR CIDADE'
FROM RouboVeiculos
WHERE CIDADE IS NOT NULL
GROUP BY CIDADE

/*OUTPUT>
RANK		CIDADE				QTD ROUBOS/CIDADE	TOTAL_ROUBOS			% POR CIDADE
1		S.PAULO					742			1703		43,57 %
2		S.ANDRE					97			1703		5,70 %
3		CAMPINAS				92			1703		5,40 %
4		S.BERNARDO DO CAMPO			78			1703		4,58 %
5		GUARULHOS				69			1703		4,05 %
6		DIADEMA					52			1703		3,05 %
7		SUMARE					42			1703		2,47 %
8		ITAQUAQUECETUBA				34			1703		2,00 %
9		HORTOLANDIA				29			1703		1,70 %
10		RIBEIRAO PRETO				28			1703		1,64 %
*/




-- ANALISE ROUBO POR MES E EVOLUÇÃO TEMPORAL NO ANO DE 2023
WITH CTE_RouboVeiculos AS (
    SELECT
        YEAR(DATAOCORRENCIA) AS ANO,
        MES,
        COUNT(*) AS QTD_ROUBOS
    FROM RouboVeiculos
    WHERE YEAR(DATAOCORRENCIA) = 2023 AND MES IS NOT NULL AND MES IN 	(1,2,3,4,5,6,7,8,9,10,11,12)
    GROUP BY YEAR(DATAOCORRENCIA), MES
)

SELECT
    ANO,
    MES,
    QTD_ROUBOS AS 'QTD ROUBOS/MES',
    LAG(QTD_ROUBOS) OVER (ORDER BY MES) AS 'MES ANTERIOR',
    CONCAT(
        CASE WHEN (QTD_ROUBOS * 1.0 / LAG(QTD_ROUBOS) OVER (ORDER BY MES) - 1) > 0 THEN 'AUMENTO EM '
             WHEN (QTD_ROUBOS * 1.0 / LAG(QTD_ROUBOS) OVER (ORDER BY MES) - 1) < 0 THEN 'QUEDA EM ' 
			 ELSE '0'
        END,
        ' ',
        FORMAT((QTD_ROUBOS * 1.0 / LAG(QTD_ROUBOS) OVER (ORDER BY MES) - 1), '0.00%') + ' DOS CASOS'
    ) AS 'VARIAÇÃO MES'
FROM CTE_RouboVeiculos;

/*OUTPUT>
ANO		MES			QTD ROUBOS/MES				 MES ANTERIOR				VARIAÇÃO MES
2023		1					183				NULL				0 
2023		2					855				183				AUMENTO EM  367,21% DOS CASOS
2023		3					70				855				QUEDA EM  -91,81% DOS CASOS
2023		4					61				70				QUEDA EM  -12,86% DOS CASOS
2023		5					68				61				AUMENTO EM  11,48% DOS CASOS
2023		6					53				68				QUEDA EM  -22,06% DOS CASOS
2023		7					61				53				AUMENTO EM  15,09% DOS CASOS
2023		8					70				61				AUMENTO EM  14,75% DOS CASOS
2023		9					64				70				QUEDA EM  -8,57% DOS CASOS
2023		10					70				64				AUMENTO EM  9,38% DOS CASOS
2023		11					64				70				QUEDA EM  -8,57% DOS CASOS
2023		12					41				64				QUEDA EM  -35,94% DOS CASOS
*/




-- DIAS DA SEMANA COM MAIOR INCIDÊNCIA DE ROUBOS E PORCENTAGEM
SELECT 
	DATENAME(WEEKDAY, DATAOCORRENCIA) AS 'DIA DA SEMANA', 
	COUNT(*) AS 'QTD ROUBOS',
	CAST((COUNT(*) * 100.0 / (SELECT COUNT(*) FROM [dbo].[RouboVeiculos])) AS DECIMAL(10, 2)) AS '%  DIA'
FROM [dbo].[RouboVeiculos]
GROUP BY DATENAME(WEEKDAY, DATAOCORRENCIA)
ORDER BY 'QTD ROUBOS' DESC

/*OUTPUT>
DIA DA SEMANA		QTD ROUBOS		%  DIA
Quinta-Feira		333			19.55
Segunda-Feira		288			16.91
Domingo			255			14.97
Sábado			227			13.33
Terça-Feira		216			12.68
Quarta-Feira		202			11.86
Sexta-Feira		182			10.69
*/



-- TOP10 HORARIOS COM MAIOR QTD ROUBOS
SELECT TOP(10) 
	CONCAT(DATEPART(HOUR, HORAOCORRENCIA) ,' HORAS') AS HORARIO , 
	COUNT(*) AS TOTAL_ROUBOS
FROM RouboVeiculos
WHERE HORAOCORRENCIA IS NOT NULL
GROUP BY DATEPART(HOUR, HORAOCORRENCIA)
ORDER BY TOTAL_ROUBOS DESC

/*OUTPUT>
HORARIO		TOTAL_ROUBOS
20 HORAS		187
21 HORAS		159
22 HORAS		157
19 HORAS		153
23 HORAS		91
17 HORAS		82
18 HORAS		77
16 HORAS		71
0 HORAS			64
13 HORAS		55
*/



-- TOP(10) MARCAS E MODELOS COM MAIOR QUANTIDADE DE ROUBOS
SELECT TOP(10)
	MARCA, 
	MODELO, 
	COUNT(*) AS QTD_ROUBOS
FROM [dbo].[RouboVeiculos]
GROUP BY MARCA, MODELO
ORDER BY QTD_ROUBOS DESC;

/*OUTPUT>
MARCA		MODELO			QTD_ROUBOS
HONDA		CG 160 FAN			90
HONDA		CG 160 TITAN			55
HONDA		CG 160 START			32
YAMAHA		FZ25 FAZER			27
HONDA		XRE 300				21
YAMAHA		XTZ250 LANDER			15
HONDA		CB 250F TWISTER			14
HONDA		CB 300R				13
HONDA		CG150 FAN ESDI			13
NISSAN		KICKS S DRCT CVT		11
*/




-- TOP10 LOCAIS COM MAIOR INCIDENCIA
SELECT TOP(10)
    DESCRICAOLOCAL,
    COUNT(*) AS QTD_ROUBOS,
    CONCAT(CAST(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM RouboVeiculos WHERE DESCRICAOLOCAL IS NOT NULL) AS DECIMAL(10, 2)), '%') AS PORCENTAGEM
FROM RouboVeiculos
WHERE DESCRICAOLOCAL IS NOT NULL
GROUP BY DESCRICAOLOCAL
ORDER BY QTD_ROUBOS DESC

/*OUTOUT>
DESCRICAOLOCAL					QTD_ROUBOS		PORCENTAGEM
Via pública						1433		84.54%
Veículo em movimento					104			6.14%
Garagem ou abrigo de residência					42			2.48%
Outros							31			1.83%
Rodovia/Estrada						18			1.06%
Estacionamento particular				16			0.94%
Residência						13			0.77%
Comércio e serviços					11			0.65%
Estacionamento público					9			0.53%
Estacionamento com vigilância				6			0.35%
*/




-- %  FLAGRANTES
SELECT
    FLAGRANTE,
    COUNT(*) AS QTD_ROUBO,
    CONCAT(CAST(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM RouboVeiculos) AS DECIMAL(10, 2)), '%') AS PORCENTAGEM
FROM RouboVeiculos
GROUP BY FLAGRANTE

/*OUTPUT>
FLAGRANTE	QTD_ROUBO		PORCENTAGEM
Sim			27			1.59%
Não			1676			98.41%
*/



-- TOP10 ROUBOS POR COR DE VEICULOS
SELECT TOP(10)
	DESCR_COR_VEICULO,
	COUNT(*) AS 'QTD_ROUBOS',
	SUM(COUNT(*)) OVER() AS 'TOTAL_ROUBOS',
	CONCAT(CAST(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM RouboVeiculos) AS DECIMAL(10, 2)), '%') AS '%'
FROM RouboVeiculos
GROUP BY DESCR_COR_VEICULO
ORDER BY QTD_ROUBOS DESC

/*OUTPUT>
DESCR_COR_VEICULO		QTD_ROUBOS	TOTAL_ROUBOS			%
Branco						377				1703			22.14%
Preta						354				1703			20.79%
Prata						282				1703			16.56%
Vermelho					246				1703			14.45%
Cinza						215				1703			12.62%
Azul						131				1703			7.69%
Verde						34				1703			2.00%
Amarelo						17				1703			1.00%
Marrom						14				1703			0.82%
Laranja						10				1703			0.59%
*/




-- TOP10 DELEGACIAS DE ATENDIMENTO
WITH AnaliseDelegacias AS (
    SELECT TOP(10)
        DELEGACIA_NOME,
        COUNT(*) AS QTD_ROUBOS,
        DENSE_RANK() OVER (ORDER BY COUNT(*) DESC) AS RANK
    FROM RouboVeiculos
    WHERE YEAR(DATAOCORRENCIA) = 2023
    GROUP BY DELEGACIA_NOME
)

SELECT
    DELEGACIA_NOME,
    QTD_ROUBOS,
    RANK
FROM AnaliseDelegacias
ORDER BY RANK;

/*OUTPUT>
DELEGACIA_NOME				QTD_ROUBOS	RANK
DELEGACIA ELETRONICA			879			1
49º D.P. SAO MATEUS				39			2
DELEGACIA ELETRONICA 3			27			3
PLANTÃO - 01 DP CAMPINAS		26			4
101º D.P. JDIM IMBUIAS			26			4
DELEGACIA ELETRONICA 2			23			5
DEL.POL.PLANTÃO HORTOLÂNDIA		21			6
16º D.P. VILA CLEMENTINO		19			7
53º D.P. PARQUE DO CARMO		18			8
DELEGACIA ELETRONICA 1			18			8
*/




-- TOP5 SOLUÇÃO DOS CASOS
WITH AnaliseResolucao AS (
    SELECT TOP(5)
        SOLUCAO,
        COUNT(*) AS QTD_ROUBOS
    FROM [dbo].[RouboVeiculos]
    WHERE YEAR(DATAOCORRENCIA) = 2023 AND SOLUCAO IS NOT NULL
    GROUP BY SOLUCAO
)

SELECT
    SOLUCAO,
    QTD_ROUBOS,
    FORMAT((QTD_ROUBOS * 100.0 / SUM(QTD_ROUBOS) OVER ()), 'N2') AS '%'
FROM AnaliseResolucao
ORDER BY QTD_ROUBOS DESC;

/*OUTPUT>
SOLUCAO							QTD_ROUBOS			%
BO PARA INVESTIGAÇÃO					1025		62,05
ENCAMINHAMENTO DP ÁREA DO FATO			349			21,13
APRECIAÇÃO DO DELEGADO TITULAR			179			10,84
BO PARA REGISTRO						74			4,48
BO PARA FLAGRANTE						25			1,51
*/


















































